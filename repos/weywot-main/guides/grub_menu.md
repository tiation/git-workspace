# How to edit the entries of grub menu

This only covers the entries, not the options of these entries. Adapted from [this](https://github.com/spxak1/weywot/blob/main/guides/fix_bios_boot_entry.md) guide.

**Note**: I use Fedora for the examples bellow, but look for a variation to make it work in **Ubuntu** at the very end

**Note**: I put this guide together because I can't stand not being able to edit the menu entries (which is so easy in systemd-boot, but almost impossible in grub).

## Principle

Grub is creating the boot menu configuration file, normally found in ```/boot/grub2/grub.cfg``` using a master configuration file for the boot options of the system **and** a number of scripts to generate other boot entries.

The configuration file for the boot options is found in ```/etc/defaults/grub```. 
This file is **not** important for this process. 

All the scripts are found in ```/etc/grub.d/```

Here's the contents of mine:

~~~
-rwxr-xr-x. 1 root root  9346 Sep 29 14:42 00_header
-rwxr-xr-x. 1 root root   236 Sep 29 14:42 01_users
-rwxr-xr-x. 1 root root   835 Sep 29 14:42 08_fallback_counting
-rwxr-xr-x. 1 root root 18669 Sep 29 14:42 10_linux
-rwxr-xr-x. 1 root root   833 Sep 29 14:42 10_reset_boot_success
-rwxr-xr-x. 1 root root   892 Sep 29 14:42 12_menu_auto_hide
-rwxr-xr-x. 1 root root   410 Sep 29 14:42 14_menu_show_once
-rwxr-xr-x. 1 root root 13613 Sep 29 14:42 20_linux_xen
-rwxr-xr-x. 1 root root  2562 Sep 29 14:42 20_ppc_terminfo
-rwxr-xr-x. 1 root root 10869 Sep 29 14:42 30_os-prober
-rwxr-xr-x. 1 root root  1122 Sep 29 14:42 30_uefi-firmware
-rwxr-xr-x. 1 root root   633 Sep 24 04:29 35_fwupd
-rwxr-xr-x. 1 root root  7902 Oct 29 22:22 40_custom
-rwxr-xr-x. 1 root root   219 Sep 29 14:42 41_custom
-rw-r--r--. 1 root root   483 Sep 29 14:42 README
~~~

Not that all these are **executable**.

For a full explanation of what each script does, see [here](https://www.dedoimedo.com/computers/grub-2.html).

Basically ```10_linux``` is seting up the menu entry for this installation, and ```30_os_prober``` for any other operating system present.

These scripts are executed sequentially by calling the commonly termed ```update-grub``` routine (for Ubuntu).

For **Fedora**, this command is ```grub2-mkconfig -o "$(readlink -e /etc/grub2.cfg)"```

**Note**: This creates an output in ```/etc/grub2.cfg``` (check yours is also a ```.cfg``` or a ```.conf``` and adjust accordingly). This is then linked to the final menu configuration file in ```/boot/grub/grub2.cfg```.

In an ideal word we could just edit that file ```/boot/grub/grub2.cfg``` and produce the menu we want, but this file is created from the script and as such everytime a new kernel is installed it will be overwritten.

So we will need to produce it in a way that persists.

## Process

First create the default menu by simply running everything as normal.

~~~
grub2-mkconfig -o "$(readlink -e /etc/grub2.cfg)"
~~~

This outputs (for example):

~~~
Generating grub configuration file ...
Found Pop!_OS 21.10 (21.10) on /dev/sda3
Adding boot menu entry for UEFI Firmware Settings ...
done
~~~

In my case it has also picked up Pop_OS which is also installed in this box.

However, the script that finds other operating systems, ```30_os-prober``` creates a menu entry for **every** every kernel it finds on the disk.

So in my case, it finds Pop_OS, and then in Pop's ```/boot``` folder it finds around 10 kernels (new, old, hardlinks) and creates a menu entry for each. Clearly thes are all redundant and need to be removed, except for just one, so that Pop boots from Fedora's grub menu.

Let's have a look at the outpu ```/boot/grub2/grub.cfg```

~~~
#
# DO NOT EDIT THIS FILE
#
# It is automatically generated by grub2-mkconfig using templates
# from /etc/grub.d and settings from /etc/default/grub
#

### BEGIN /etc/grub.d/00_header ###
set pager=1

if [ -f ${config_directory}/grubenv ]; then
  load_env -f ${config_directory}/grubenv
elif [ -s $prefix/grubenv ]; then
  load_env
fi
if [ "${next_entry}" ] ; then
   set default="${next_entry}"
   set next_entry=
   save_env next_entry
   set boot_once=true
else
   set default="${saved_entry}"
fi

if [ x"${feature_menuentry_id}" = xy ]; then
  menuentry_id_option="--id"
else
  menuentry_id_option=""
fi

export menuentry_id_option

if [ "${prev_saved_entry}" ]; then
  set saved_entry="${prev_saved_entry}"
  save_env saved_entry
  set prev_saved_entry=
  save_env prev_saved_entry
  set boot_once=true
fi

function savedefault {
  if [ -z "${boot_once}" ]; then
    saved_entry="${chosen}"
    save_env saved_entry
  fi
}

function load_video {
  if [ x$feature_all_video_module = xy ]; then
    insmod all_video
  else
    insmod efi_gop
    insmod efi_uga
    insmod ieee1275_fb
    insmod vbe
    insmod vga
    insmod video_bochs
    insmod video_cirrus
  fi
}

terminal_output console
if [ x$feature_timeout_style = xy ] ; then
  set timeout_style=menu
  set timeout=5
# Fallback normal timeout code in case the timeout_style feature is
# unavailable.
else
  set timeout=5
fi
### END /etc/grub.d/00_header ###

### BEGIN /etc/grub.d/01_users ###
if [ -f ${prefix}/user.cfg ]; then
  source ${prefix}/user.cfg
  if [ -n "${GRUB2_PASSWORD}" ]; then
    set superusers="root"
    export superusers
    password_pbkdf2 root ${GRUB2_PASSWORD}
  fi
fi
### END /etc/grub.d/01_users ###

### BEGIN /etc/grub.d/08_fallback_counting ###
insmod increment
# Check if boot_counter exists and boot_success=0 to activate this behaviour.
if [ -n "${boot_counter}" -a "${boot_success}" = "0" ]; then
  # if countdown has ended, choose to boot rollback deployment,
  # i.e. default=1 on OSTree-based systems.
  if  [ "${boot_counter}" = "0" -o "${boot_counter}" = "-1" ]; then
    set default=1
    set boot_counter=-1
  # otherwise decrement boot_counter
  else
    decrement boot_counter
  fi
  save_env boot_counter
fi
### END /etc/grub.d/08_fallback_counting ###

### BEGIN /etc/grub.d/10_linux ###
insmod part_gpt
insmod btrfs
set root='hd0,gpt4'
if [ x$feature_platform_search_hint = xy ]; then
  search --no-floppy --fs-uuid --set=root --hint-bios=hd0,gpt4 --hint-efi=hd0,gpt4 --hint-baremetal=ahci0,gpt4  63d4fbbb-b695-4102-bd9a-75f1985a14e8
else
  search --no-floppy --fs-uuid --set=root 63d4fbbb-b695-4102-bd9a-75f1985a14e8
fi
insmod part_gpt
insmod fat
set boot='hd0,gpt1'
if [ x$feature_platform_search_hint = xy ]; then
  search --no-floppy --fs-uuid --set=boot --hint-bios=hd0,gpt1 --hint-efi=hd0,gpt1 --hint-baremetal=ahci0,gpt1  9BA6-85B8
else
  search --no-floppy --fs-uuid --set=boot 9BA6-85B8
fi

# This section was generated by a script. Do not modify the generated file - all changes
# will be lost the next time file is regenerated. Instead edit the BootLoaderSpec files.
#
# The blscfg command parses the BootLoaderSpec files stored in /boot/loader/entries and
# populates the boot menu. Please refer to the Boot Loader Specification documentation
# for the files format: https://systemd.io/BOOT_LOADER_SPECIFICATION/.

# The kernelopts variable should be defined in the grubenv file. But to ensure that menu
# entries populated from BootLoaderSpec files that use this variable work correctly even
# without a grubenv file, define a fallback kernelopts variable if this has not been set.
#
# The kernelopts variable in the grubenv file can be modified using the grubby tool or by
# executing the grub2-mkconfig tool. For the latter, the values of the GRUB_CMDLINE_LINUX
# and GRUB_CMDLINE_LINUX_DEFAULT options from /etc/default/grub file are used to set both
# the kernelopts variable in the grubenv file and the fallback kernelopts variable.
if [ -z "${kernelopts}" ]; then
  set kernelopts="root=UUID=63d4fbbb-b695-4102-bd9a-75f1985a14e8 ro rootflags=subvol=root resume=UUID=e09206f5-31bd-41b7-9175-54b1bcda8cde rhgb quiet mitigations=off "
fi

insmod blscfg
blscfg
### END /etc/grub.d/10_linux ###

### BEGIN /etc/grub.d/10_reset_boot_success ###
# Hiding the menu is ok if last boot was ok or if this is a first boot attempt to boot the entry
if [ "${boot_success}" = "1" -o "${boot_indeterminate}" = "1" ]; then
  set menu_hide_ok=1
else
  set menu_hide_ok=0 
fi
# Reset boot_indeterminate after a successful boot
if [ "${boot_success}" = "1" ] ; then
  set boot_indeterminate=0
# Avoid boot_indeterminate causing the menu to be hidden more than once
elif [ "${boot_indeterminate}" = "1" ]; then
  set boot_indeterminate=2
fi
# Reset boot_success for current boot 
set boot_success=0
save_env boot_success boot_indeterminate
### END /etc/grub.d/10_reset_boot_success ###

### BEGIN /etc/grub.d/12_menu_auto_hide ###
if [ x$feature_timeout_style = xy ] ; then
  if [ "${menu_show_once}" ]; then
    unset menu_show_once
    save_env menu_show_once
    set timeout_style=menu
    set timeout=60
  elif [ "${menu_auto_hide}" -a "${menu_hide_ok}" = "1" ]; then
    set orig_timeout_style=${timeout_style}
    set orig_timeout=${timeout}
    if [ "${fastboot}" = "1" ]; then
      # timeout_style=menu + timeout=0 avoids the countdown code keypress check
      set timeout_style=menu
      set timeout=0
    else
      set timeout_style=hidden
      set timeout=1
    fi
  fi
fi
### END /etc/grub.d/12_menu_auto_hide ###

### BEGIN /etc/grub.d/14_menu_show_once ###
if [ x$feature_timeout_style = xy ]; then
  if [ "${menu_show_once_timeout}" ]; then
    set timeout_style=menu
    set timeout="${menu_show_once_timeout}"
    unset menu_show_once_timeout
    save_env menu_show_once_timeout
  fi
fi
### END /etc/grub.d/14_menu_show_once ###

### BEGIN /etc/grub.d/20_linux_xen ###

### END /etc/grub.d/20_linux_xen ###

### BEGIN /etc/grub.d/20_ppc_terminfo ###
### END /etc/grub.d/20_ppc_terminfo ###

### BEGIN /etc/grub.d/30_os-prober ###
	menuentry 'Pop!_OS 21.10 (21.10) (on /dev/sda3)' --class gnu-linux --class gnu --class os $menuentry_id_option 'osprober-gnulinux-/boot/vmlinuz--f63b7272-6736-49c9-898f-6bcb8d05f613' {
		insmod part_gpt
		insmod ext2
		set root='hd0,gpt3'
		if [ x$feature_platform_search_hint = xy ]; then
		  search --no-floppy --fs-uuid --set=root --hint-bios=hd0,gpt3 --hint-efi=hd0,gpt3 --hint-baremetal=ahci0,gpt3  f63b7272-6736-49c9-898f-6bcb8d05f613
		else
		  search --no-floppy --fs-uuid --set=root f63b7272-6736-49c9-898f-6bcb8d05f613
		fi
		linux /boot/vmlinuz root=/dev/sda3
		initrd /boot/initrd.img
	}
	menuentry 'Pop!_OS 21.10 (21.10) (on /dev/sda3)' --class gnu-linux --class gnu --class os $menuentry_id_option 'osprober-gnulinux-/boot/vmlinuz--f63b7272-6736-49c9-898f-6bcb8d05f613' {
		insmod part_gpt
		insmod ext2
		set root='hd0,gpt3'
		if [ x$feature_platform_search_hint = xy ]; then
		  search --no-floppy --fs-uuid --set=root --hint-bios=hd0,gpt3 --hint-efi=hd0,gpt3 --hint-baremetal=ahci0,gpt3  f63b7272-6736-49c9-898f-6bcb8d05f613
		else
		  search --no-floppy --fs-uuid --set=root f63b7272-6736-49c9-898f-6bcb8d05f613
		fi
		linux /boot/vmlinuz root=/dev/sda3
		initrd /boot/initrd.img
	}
	menuentry 'Pop!_OS 21.10 (21.10) (on /dev/sda3)' --class gnu-linux --class gnu --class os $menuentry_id_option 'osprober-gnulinux-/boot/vmlinuz--f63b7272-6736-49c9-898f-6bcb8d05f613' {
		insmod part_gpt
		insmod ext2
		set root='hd0,gpt3'
		if [ x$feature_platform_search_hint = xy ]; then
		  search --no-floppy --fs-uuid --set=root --hint-bios=hd0,gpt3 --hint-efi=hd0,gpt3 --hint-baremetal=ahci0,gpt3  f63b7272-6736-49c9-898f-6bcb8d05f613
		else
		  search --no-floppy --fs-uuid --set=root f63b7272-6736-49c9-898f-6bcb8d05f613
		fi
		linux /boot/vmlinuz root=/dev/sda3
		initrd /boot/initrd.img-5.13.0-7614-generic
	}
	menuentry 'Pop!_OS 21.10 (21.10) (on /dev/sda3)' --class gnu-linux --class gnu --class os $menuentry_id_option 'osprober-gnulinux-/boot/vmlinuz--f63b7272-6736-49c9-898f-6bcb8d05f613' {
		insmod part_gpt
		insmod ext2
		set root='hd0,gpt3'
		if [ x$feature_platform_search_hint = xy ]; then
		  search --no-floppy --fs-uuid --set=root --hint-bios=hd0,gpt3 --hint-efi=hd0,gpt3 --hint-baremetal=ahci0,gpt3  f63b7272-6736-49c9-898f-6bcb8d05f613
		else
		  search --no-floppy --fs-uuid --set=root f63b7272-6736-49c9-898f-6bcb8d05f613
		fi
		linux /boot/vmlinuz root=/dev/sda3
		initrd /boot/initrd.img-5.13.0-7620-generic
	}
	menuentry 'Pop!_OS 21.10 (21.10) (on /dev/sda3)' --class gnu-linux --class gnu --class os $menuentry_id_option 'osprober-gnulinux-/boot/vmlinuz--f63b7272-6736-49c9-898f-6bcb8d05f613' {
		insmod part_gpt
		insmod ext2
		set root='hd0,gpt3'
		if [ x$feature_platform_search_hint = xy ]; then
		  search --no-floppy --fs-uuid --set=root --hint-bios=hd0,gpt3 --hint-efi=hd0,gpt3 --hint-baremetal=ahci0,gpt3  f63b7272-6736-49c9-898f-6bcb8d05f613
		else
		  search --no-floppy --fs-uuid --set=root f63b7272-6736-49c9-898f-6bcb8d05f613
		fi
		linux /boot/vmlinuz root=/dev/sda3
		initrd /boot/initrd.img.old
	}
	menuentry 'Pop!_OS 21.10 (21.10) (on /dev/sda3)' --class gnu-linux --class gnu --class os $menuentry_id_option 'osprober-gnulinux-/boot/vmlinuz--f63b7272-6736-49c9-898f-6bcb8d05f613' {
		insmod part_gpt
		insmod ext2
		set root='hd0,gpt3'
		if [ x$feature_platform_search_hint = xy ]; then
		  search --no-floppy --fs-uuid --set=root --hint-bios=hd0,gpt3 --hint-efi=hd0,gpt3 --hint-baremetal=ahci0,gpt3  f63b7272-6736-49c9-898f-6bcb8d05f613
		else
		  search --no-floppy --fs-uuid --set=root f63b7272-6736-49c9-898f-6bcb8d05f613
		fi
		linux /boot/vmlinuz root=/dev/sda3
		initrd /boot/initrd.img
	}
	menuentry 'Pop!_OS 21.10 (21.10) (on /dev/sda3)' --class gnu-linux --class gnu --class os $menuentry_id_option 'osprober-gnulinux-/boot/vmlinuz--f63b7272-6736-49c9-898f-6bcb8d05f613' {
		insmod part_gpt
		insmod ext2
		set root='hd0,gpt3'
		if [ x$feature_platform_search_hint = xy ]; then
		  search --no-floppy --fs-uuid --set=root --hint-bios=hd0,gpt3 --hint-efi=hd0,gpt3 --hint-baremetal=ahci0,gpt3  f63b7272-6736-49c9-898f-6bcb8d05f613
		else
		  search --no-floppy --fs-uuid --set=root f63b7272-6736-49c9-898f-6bcb8d05f613
		fi
		linux /boot/vmlinuz root=/dev/sda3
		initrd /boot/initrd.img
	}
	menuentry 'Pop!_OS 21.10 (21.10) (on /dev/sda3)' --class gnu-linux --class gnu --class os $menuentry_id_option 'osprober-gnulinux-/boot/vmlinuz--f63b7272-6736-49c9-898f-6bcb8d05f613' {
		insmod part_gpt
		insmod ext2
		set root='hd0,gpt3'
		if [ x$feature_platform_search_hint = xy ]; then
		  search --no-floppy --fs-uuid --set=root --hint-bios=hd0,gpt3 --hint-efi=hd0,gpt3 --hint-baremetal=ahci0,gpt3  f63b7272-6736-49c9-898f-6bcb8d05f613
		else
		  search --no-floppy --fs-uuid --set=root f63b7272-6736-49c9-898f-6bcb8d05f613
		fi
		linux /boot/vmlinuz root=/dev/sda3
		initrd /boot/initrd.img-5.13.0-7614-generic
	}
	menuentry 'Pop!_OS 21.10 (21.10) (on /dev/sda3)' --class gnu-linux --class gnu --class os $menuentry_id_option 'osprober-gnulinux-/boot/vmlinuz--f63b7272-6736-49c9-898f-6bcb8d05f613' {
		insmod part_gpt
		insmod ext2
		set root='hd0,gpt3'
		if [ x$feature_platform_search_hint = xy ]; then
		  search --no-floppy --fs-uuid --set=root --hint-bios=hd0,gpt3 --hint-efi=hd0,gpt3 --hint-baremetal=ahci0,gpt3  f63b7272-6736-49c9-898f-6bcb8d05f613
		else
		  search --no-floppy --fs-uuid --set=root f63b7272-6736-49c9-898f-6bcb8d05f613
		fi
		linux /boot/vmlinuz root=/dev/sda3
		initrd /boot/initrd.img-5.13.0-7620-generic
	}
	menuentry 'Pop!_OS 21.10 (21.10) (on /dev/sda3)' --class gnu-linux --class gnu --class os $menuentry_id_option 'osprober-gnulinux-/boot/vmlinuz--f63b7272-6736-49c9-898f-6bcb8d05f613' {
		insmod part_gpt
		insmod ext2
		set root='hd0,gpt3'
		if [ x$feature_platform_search_hint = xy ]; then
		  search --no-floppy --fs-uuid --set=root --hint-bios=hd0,gpt3 --hint-efi=hd0,gpt3 --hint-baremetal=ahci0,gpt3  f63b7272-6736-49c9-898f-6bcb8d05f613
		else
		  search --no-floppy --fs-uuid --set=root f63b7272-6736-49c9-898f-6bcb8d05f613
		fi
		linux /boot/vmlinuz root=/dev/sda3
		initrd /boot/initrd.img.old
	}
	menuentry 'Pop!_OS 21.10 (21.10) (on /dev/sda3)' --class gnu-linux --class gnu --class os $menuentry_id_option 'osprober-gnulinux-/boot/vmlinuz-5.13.0-7614-generic--f63b7272-6736-49c9-898f-6bcb8d05f613' {
		insmod part_gpt
		insmod ext2
		set root='hd0,gpt3'
		if [ x$feature_platform_search_hint = xy ]; then
		  search --no-floppy --fs-uuid --set=root --hint-bios=hd0,gpt3 --hint-efi=hd0,gpt3 --hint-baremetal=ahci0,gpt3  f63b7272-6736-49c9-898f-6bcb8d05f613
		else
		  search --no-floppy --fs-uuid --set=root f63b7272-6736-49c9-898f-6bcb8d05f613
		fi
		linux /boot/vmlinuz-5.13.0-7614-generic root=/dev/sda3
		initrd /boot/initrd.img-5.13.0-7614-generic
	}
	menuentry 'Pop!_OS 21.10 (21.10) (on /dev/sda3)' --class gnu-linux --class gnu --class os $menuentry_id_option 'osprober-gnulinux-/boot/vmlinuz-5.13.0-7620-generic--f63b7272-6736-49c9-898f-6bcb8d05f613' {
		insmod part_gpt
		insmod ext2
		set root='hd0,gpt3'
		if [ x$feature_platform_search_hint = xy ]; then
		  search --no-floppy --fs-uuid --set=root --hint-bios=hd0,gpt3 --hint-efi=hd0,gpt3 --hint-baremetal=ahci0,gpt3  f63b7272-6736-49c9-898f-6bcb8d05f613
		else
		  search --no-floppy --fs-uuid --set=root f63b7272-6736-49c9-898f-6bcb8d05f613
		fi
		linux /boot/vmlinuz-5.13.0-7620-generic root=/dev/sda3
		initrd /boot/initrd.img-5.13.0-7620-generic
	}
	menuentry 'Pop!_OS 21.10 (21.10) (on /dev/sda3)' --class gnu-linux --class gnu --class os $menuentry_id_option 'osprober-gnulinux-/boot/vmlinuz.old--f63b7272-6736-49c9-898f-6bcb8d05f613' {
		insmod part_gpt
		insmod ext2
		set root='hd0,gpt3'
		if [ x$feature_platform_search_hint = xy ]; then
		  search --no-floppy --fs-uuid --set=root --hint-bios=hd0,gpt3 --hint-efi=hd0,gpt3 --hint-baremetal=ahci0,gpt3  f63b7272-6736-49c9-898f-6bcb8d05f613
		else
		  search --no-floppy --fs-uuid --set=root f63b7272-6736-49c9-898f-6bcb8d05f613
		fi
		linux /boot/vmlinuz.old root=/dev/sda3
		initrd /boot/initrd.img.old
	}

# Other OS found, undo autohiding of menu unless menu_auto_hide=2
if [ "${orig_timeout_style}" -a "${menu_auto_hide}" != "2" ]; then
  set timeout_style=${orig_timeout_style}
  set timeout=${orig_timeout}
fi
### END /etc/grub.d/30_os-prober ###

### BEGIN /etc/grub.d/30_uefi-firmware ###
if [ "$grub_platform" = "efi" ]; then
	menuentry 'UEFI Firmware Settings' $menuentry_id_option 'uefi-firmware' {
		fwsetup
	}
fi
### END /etc/grub.d/30_uefi-firmware ###

### BEGIN /etc/grub.d/35_fwupd ###
### END /etc/grub.d/35_fwupd ###

### BEGIN /etc/grub.d/41_custom ###
if [ -f  ${config_directory}/custom.cfg ]; then
  source ${config_directory}/custom.cfg
elif [ -z "${config_directory}" -a -f  $prefix/custom.cfg ]; then
  source $prefix/custom.cfg
fi
### END /etc/grub.d/41_custom ###
~~~

Look at this nightmare. Totally uneditable. You can see how many times Pop repeats. We only need the very first entry. But we cannot edit and delete the others so here's the trick.

## Using 40_custom to edit the entries

Change to sudo with ```sudo su```. **Careful** from this point.

### 1. Make a copy of the original ```40_custom``` file.
~~~
cp /etc/grub.d/40_custom /etc/grub.d/40_custom.default
~~~
Or just ```cd``` to ```/etc/grub.d``` to avoid writing all the paths.


### 2. Take the contents of this file and **append** them to ```40_custom```
~~~ 
cat /boot/grub2/grub.cfg >> /etc/grub.d/40_custom
~~~

**Note**: I use ```>>```, which appends and not a singe ```>``` which replaces the contents.

### 3. Edit 40_custom and remove 

Find the lines after ```### BEGIN /etc/grub.d/30_os-prober ###```. They start with ```menuentry``` and each menu entry finishes with a ```}```.

Example:
~~~
	menuentry 'Pop!_OS 21.10 (21.10) (on /dev/sda3)' --class gnu-linux --class gnu --class os $menuentry_id_option 'osprober-gnulinux-/boot/vmlinuz.old--f63b7272-6736-49c9-898f-6bcb8d05f613' {
		insmod part_gpt
		insmod ext2
		set root='hd0,gpt3'
		if [ x$feature_platform_search_hint = xy ]; then
		  search --no-floppy --fs-uuid --set=root --hint-bios=hd0,gpt3 --hint-efi=hd0,gpt3 --hint-baremetal=ahci0,gpt3  f63b7272-6736-49c9-898f-6bcb8d05f613
		else
		  search --no-floppy --fs-uuid --set=root f63b7272-6736-49c9-898f-6bcb8d05f613
		fi
		linux /boot/vmlinuz.old root=/dev/sda3
		initrd /boot/initrd.img.old
	}
  ~~~
  
  This entry is for the older kernel, and as such is not required.
  
  **Delete** all entries that are not required, from the ```menuentry``` start all the way (and including) the ```}```.
  
  Your ```40_custom``` file is ready to be used.
  
  ### 4. Make 40_custom executable, and remove the executable bit from 30_os-prober
  
  Quite simply 
  ~~~
  chmod +x 40_custom
  ~~~
  
  and 
  ~~~
  chomd -x 30_os-prober
  ~~~
  
  ### 5. Create the menu again
  
  No rerun
  ~~~
  grub2-mkconfig -o "$(readlink -e /etc/grub2.cfg)"
~~~

This will generate a new ```/boot/grub2/grub.cfg``` with only that menuentry you left in ```40_custom```.

## Conclusion

Grub is horrible. But it's ubiquitous. So it's a good skill to be able to do the basics. This is more like a workaround rather than a proper way of doing it, but I've yet to find another way.

Leave ```30_os-prober``` without the executable bit, but **remember** if you need to add other operating systems, to reset it. Good luck.






